<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>æ–°æ˜¥å…å• - è°æ˜¯ä½ çš„â€œé‚»â€è·ç¦»</title>
    <style>
        :root {
            --primary-red: #E02E24;
            --primary-orange: #FF5000;
            --bg-color: #f2f2f2;
            --modal-mask: rgba(0, 0, 0, 0.75);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(#ddd 1px, transparent 1px);
            background-size: 20px 20px;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none; 
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }

        /* --- 1. é¡¶éƒ¨æ°›å›´æ¡ --- */
        .top-bar {
            position: fixed;
            top: 0; left: 0; width: 100%; 
            height: 40px;
            padding-top: env(safe-area-inset-top);
            background: rgba(0,0,0,0.8);
            color: #fff;
            display: flex;
            align-items: center;
            padding-left: 10px;
            padding-right: 10px;
            z-index: 100;
            font-size: 12px;
            backdrop-filter: blur(5px);
            box-sizing: content-box;
        }
        .scrolling-text {
            flex: 1; overflow: hidden; white-space: nowrap; margin-left: 10px; position: relative;
        }
        .scrolling-text span {
            display: inline-block;
            animation: scroll 12s linear infinite;
        }
        @keyframes scroll { from { transform: translateX(100%); } to { transform: translateX(-150%); } }

        /* --- 2. å€’è®¡æ—¶çƒ --- */
        .timer-ball {
            position: fixed;
            top: calc(50px + env(safe-area-inset-top));
            right: 15px;
            width: 50px; height: 50px;
            background: linear-gradient(180deg, #FF5000 0%, #E02E24 100%);
            border-radius: 50%;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            box-shadow: 0 4px 10px rgba(224, 46, 36, 0.4);
            z-index: 90;
            border: 2px solid #fff;
            animation: pulse 1s infinite;
        }
        .timer-ball b { font-size: 14px; line-height: 1; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- 3. æ¸¸æˆåœ°å›¾åŒºåŸŸ --- */
        .game-area {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
            box-sizing: border-box;
            padding-top: 40px; 
            padding-bottom: 80px;
        }

        /* æ–°å¢ï¼šæ¸¸æˆå¤§æ ‡é¢˜ */
        .game-title {
            position: absolute;
            top: 12%; /* ä¿®æ”¹ç‚¹ï¼šä»15%ä¸Šç§»åˆ°12% */
            left: 0;
            width: 100%;
            text-align: center;
            pointer-events: none; /* å…³é”®ï¼šä¸é˜»æŒ¡ç‚¹å‡» */
            z-index: 5; /* ä½äºå¤´åƒä¹‹ä¸‹ */
            /* ä¿®æ”¹ç‚¹ï¼šç§»é™¤äº† animation: floatTitle ... */
        }
        .game-title h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 900;
            color: var(--primary-red);
            text-shadow: 2px 2px 0px #fff, -1px -1px 0 #fff, 0 4px 10px rgba(0,0,0,0.1);
            letter-spacing: 1px;
            font-style: italic;
        }
        .game-title .subtitle {
            font-size: 12px;
            color: #666;
            background: rgba(255,255,255,0.8);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-top: 5px;
        }
        
        /* ä¸­å¿ƒçš„â€œæˆ‘â€ */
        .me-center {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 64px; height: 64px;
            background: #fff;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            box-shadow: 0 0 0 5px rgba(255, 255, 255, 0.5), 0 0 20px rgba(255, 80, 0, 0.3);
            color: var(--primary-red);
            font-weight: bold;
            font-size: 12px;
        }
        .me-center img { width: 30px; margin-bottom: 2px; }
        /* é›·è¾¾æ‰«ææ³¢çº¹ */
        .radar-wave {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 100px; height: 100px;
            border: 1px solid rgba(255, 80, 0, 0.3);
            border-radius: 50%;
            animation: ripple 2s infinite linear;
            pointer-events: none;
        }
        .radar-wave:nth-child(2) { animation-delay: 0.5s; }
        .radar-wave:nth-child(3) { animation-delay: 1s; }
        @keyframes ripple {
            0% { width: 64px; height: 64px; opacity: 0.8; border-width: 2px; }
            100% { width: 300px; height: 300px; opacity: 0; border-width: 0; }
        }

        /* æœåŠ¡è€…å¤´åƒ */
        .avatar-node {
            position: absolute;
            width: 56px; height: 56px; /* ç¨å¾®åŠ å¤§ä¸€ç‚¹å¤´åƒ */
            background: #fff;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 20; /* ç¡®ä¿åœ¨æ ‡é¢˜ä¹‹ä¸Š */
            cursor: pointer;
            overflow: visible; /* å…è®¸æ ‡ç­¾æº¢å‡º */
        }
        /* çœŸå®å›¾ç‰‡é€‚é… */
        .avatar-node img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            pointer-events: none;
        }
        .avatar-node.dead {
            transform: scale(0);
            opacity: 0;
        }
        /* åŠ å¤§çš„æ ‡ç­¾æ ·å¼ */
        .avatar-label {
            position: absolute;
            bottom: -22px; /* è°ƒæ•´ä½ç½® */
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            padding: 4px 10px; /* åŠ å¤§å†…è¾¹è· */
            border-radius: 12px;
            font-size: 12px; /* åŠ å¤§å­—å· */
            font-weight: bold; /* åŠ ç²— */
            color: #333;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            border: 1px solid #fff;
            pointer-events: none;
            z-index: 21;
        }

        /* --- 4. åº•éƒ¨é“å…·æ  --- */
        .bottom-hud {
            position: fixed;
            bottom: 20px;
            left: 5%; width: 90%;
            background: #fff;
            border-radius: 50px;
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 90;
            box-sizing: border-box;
            margin-bottom: env(safe-area-inset-bottom);
        }
        .hint-text {
            flex: 1;
            font-size: 12px;
            color: #666;
            margin-left: 10px;
            line-height: 1.3;
        }
        .hint-text b { color: var(--primary-red); font-size: 14px; }
        
        .prop-btn {
            background: linear-gradient(90deg, #FFD940 0%, #FFC107 100%);
            border: none;
            border-radius: 40px;
            height: 44px;
            padding: 0 20px;
            color: #8B5900;
            font-weight: bold;
            font-size: 13px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(255, 193, 7, 0.5);
            animation: shake-btn 3s infinite;
        }
        @keyframes shake-btn {
            0%, 90% { transform: rotate(0); }
            92% { transform: rotate(-5deg); }
            94% { transform: rotate(5deg); }
            96% { transform: rotate(-5deg); }
            98% { transform: rotate(5deg); }
            100% { transform: rotate(0); }
        }

        /* --- 5. æ¡£æ¡ˆè¯¦æƒ…å¼¹çª— --- */
        .modal-profile {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--modal-mask);
            z-index: 200;
            display: none;
            justify-content: center;
            align-items: flex-end;
            height: 100vh; 
            height: -webkit-fill-available;
        }
        .profile-card {
            width: 100%;
            height: 75vh;
            background: #f8f8f8;
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease-out;
            padding-bottom: env(safe-area-inset-bottom);
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        .p-header {
            background: #fff; padding: 20px; display: flex; align-items: center;
        }
        .p-avatar {
            width: 60px; height: 60px; border-radius: 50%; margin-right: 15px;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
            border: 2px solid #eee;
        }
        .p-avatar img { width: 100%; height: 100%; object-fit: cover; }
        
        .p-info h2 { margin: 0; font-size: 18px; }
        .p-tags span {
            font-size: 10px; background: #FFF0E9; color: var(--primary-orange);
            padding: 2px 5px; border-radius: 4px; margin-right: 5px;
        }

        .p-stats {
            display: flex; background: #fff; padding: 10px 0; margin-top: 1px;
        }
        .p-stat { flex: 1; text-align: center; font-size: 12px; color: #999; border-right: 1px solid #eee; }
        .p-stat b { display: block; font-size: 16px; color: #333; margin-bottom: 2px; }

        .p-secret {
            margin: 15px; background: #fff; border-radius: 10px; padding: 15px;
        }
        .secret-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-size: 14px; color: #555;
        }
        .blur-strip {
            position: relative;
            color: transparent;
            background: #eee;
            border-radius: 4px;
            padding: 2px 5px;
            user-select: none;
        }
        .blur-strip::after {
            content: 'éšç§ä¿æŠ¤ä¸­';
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: #999;
            background: rgba(255,255,255,0.5);
            backdrop-filter: blur(4px);
        }

        .p-actions {
            margin-top: auto;
            background: #fff;
            padding: 15px;
            display: flex;
            gap: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .btn {
            flex: 1; height: 44px; border-radius: 22px; border: none; font-weight: bold; font-size: 16px;
        }
        .btn-outline { background: #f5f5f5; color: #666; }
        .btn-primary { 
            background: linear-gradient(90deg, #FF6034 0%, #EE0A24 100%); 
            color: #fff;
            box-shadow: 0 4px 10px rgba(238, 10, 36, 0.3);
        }

        /* --- 6. åé¦ˆå¼¹çª— --- */
        .modal-feedback {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 300;
            display: none;
            align-items: center; justify-content: center;
        }
        .fb-card {
            width: 80%;
            background: #fff;
            border-radius: 16px;
            text-align: center;
            padding: 25px 20px;
            position: relative;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: linear-gradient(180deg, #FFF5F5 0%, #FFFFFF 100%);
            border: 2px solid #FFD940;
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .fb-icon { font-size: 40px; margin-bottom: 10px; display: block; }
        .fb-title { font-size: 20px; color: var(--primary-red); font-weight: 800; margin: 0 0 10px 0; }
        .fb-msg { font-size: 14px; color: #333; margin-bottom: 20px; line-height: 1.5; }
        
        .clue-box {
            background: #FFF8D6;
            border: 1px dashed #FFD940;
            color: #B67B02;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 20px;
            text-align: left;
            display: flex;
            align-items: center;
        }
        .clue-icon { font-size: 20px; margin-right: 10px; }

    </style>
</head>
<body>

    <!-- é¡¶éƒ¨ -->
    <div class="top-bar">
        <span style="color:#FFD940; font-weight:bold;">ğŸ”¥ æ­£åœ¨çƒ­æŠ¢</span>
        <div class="scrolling-text">
            <span>å°¾å·8291ç”¨æˆ·çŒœä¸­å…å• Â· å°¾å·3302ç”¨æˆ·è·å¾—50å…ƒåˆ¸ Â· æœ¬è½®ç«çŒœå³å°†ç»“æŸ</span>
        </div>
    </div>

    <!-- å€’è®¡æ—¶ -->
    <div class="timer-ball">
        <span>å‰©</span>
        <b id="timer">05:00</b>
    </div>

    <!-- æ¸¸æˆåœ°å›¾ -->
    <div class="game-area" id="mapArea">
        <div class="radar-wave"></div>
        <div class="radar-wave"></div>
        <div class="radar-wave"></div>
        
        <!-- æ–°å¢æ ‡é¢˜ï¼šä½ç½®åœ¨ 12% top -->
        <div class="game-title">
            <h1>è°æ˜¯ä½ çš„â€œé‚»â€è·ç¦»</h1>
            <!-- ä¿®æ”¹ç‚¹ï¼šæ–‡æ¡ˆå˜æ›´ -->
            <div class="subtitle">æ‰¾åˆ°ä½ èº«è¾¹3å…¬é‡Œå†…çš„æœåŠ¡é«˜æ‰‹</div>
        </div>

        <div class="me-center">
            <div style="font-size:24px;">ğŸ¤ª</div>
            <div>æˆ‘</div>
        </div>
        <!-- JSç”Ÿæˆå¤´åƒ -->
    </div>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <div class="bottom-hud">
        <div class="hint-text">
            å·²æœ‰ <b>3,402äºº</b> å‚ä¸<br>
            åªæœ‰ 1 äººåœ¨ä½  100ç±³ å†…ï¼
        </div>
        <button class="prop-btn" onclick="useProp()">
            ğŸ” é«˜æ‰‹çº¿ç´¢æç¤º (å‰©<span id="propCount">2</span>)
        </button>
    </div>

    <!-- 1. æ¡£æ¡ˆæŸ¥çœ‹å¼¹çª— -->
    <div class="modal-profile" id="profileModal">
        <div class="profile-card">
            <div style="position:absolute; top:15px; right:15px; font-size:24px; color:#999; z-index:10;" onclick="closeProfile()">Ã—</div>
            
            <div class="p-header">
                <div class="p-avatar">
                    <img id="pAvatarImg" src="" alt="å¤´åƒ">
                </div>
                <div class="p-info">
                    <h2 id="pName">æœåŠ¡è€…å§“å</h2>
                    <div class="p-tags" id="pTags" style="margin-top:5px;">
                        <!-- æ ‡ç­¾ -->
                    </div>
                </div>
            </div>

            <div class="p-stats">
                <div class="p-stat"><b id="pOrders">0</b>æ€»æ¥å•</div>
                <div class="p-stat"><b id="pScore">0</b>è¯„åˆ†</div>
                <div class="p-stat"><b id="pAge">0</b>å¹´é¾„</div>
            </div>

            <div class="p-secret">
                <div style="font-weight:bold; margin-bottom:15px; color:#333;">éšç§ä¿¡æ¯ (å·²åŠ å¯†)</div>
                
                <div class="secret-row">
                    <span>å½“å‰è·ç¦»</span>
                    <div class="blur-strip" style="width:100px;">0.12km</div>
                </div>
                <div class="secret-row">
                    <span>å¸¸é©»åœ°å€</span>
                    <div class="blur-strip" style="width:140px;">æœé˜³åŒºé’å¹´è·¯</div>
                </div>
                <div class="secret-row">
                    <span>æœ€è¿‘æœåŠ¡</span>
                    <div class="blur-strip" style="width:160px;">ä¸‡ç§‘åŸå¸‚èŠ±å›­AåŒº</div>
                </div>
                
                <div style="font-size:12px; color:#999; margin-top:10px; line-height:1.4;">
                    * ä¸ºä¿æŠ¤æœåŠ¡è€…éšç§ï¼Œå…·ä½“ä½ç½®ä¿¡æ¯ä»…åœ¨ä¸­å¥–åå±•ç¤ºã€‚<br>
                    è¯·æ ¹æ®<b>â€œé«˜æ‰‹çº¿ç´¢æç¤ºâ€</b>æä¾›çš„æ–¹ä½å’Œç‰¹å¾è¿›è¡Œæ¨ç†ã€‚
                </div>
            </div>

            <div class="p-actions">
                <button class="btn btn-outline" onclick="closeProfile()">å†çœ‹çœ‹åˆ«äºº</button>
                <button class="btn btn-primary" onclick="confirmGuess()">é€‰TAï¼ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- 2. æƒ…ç»ªåé¦ˆ/çº¿ç´¢å¼¹çª— -->
    <div class="modal-feedback" id="feedbackModal">
        <div class="fb-card">
            <span class="fb-icon" id="fbIcon">ğŸ˜­</span>
            <h3 class="fb-title" id="fbTitle">å“å‘€é€‰é”™äº†ï¼</h3>
            <p class="fb-msg" id="fbMsg">
                å…å•å¤§å¥–å·®ç‚¹å°±åˆ°æ‰‹äº†ï¼<br>åˆ«ç°å¿ƒï¼Œå·å·ç»™ä½ ä¸€ä¸ªå…³é”®çº¿ç´¢ï¼
            </p>
            
            <!-- æ ¸å¿ƒï¼šçº¿ç´¢å±•ç¤ºåŒº -->
            <div class="clue-box" id="clueBox">
                <span class="clue-icon">ğŸ§­</span>
                <span id="clueText">çº¿ç´¢ï¼šçœŸæ­£çš„ç¦æ˜Ÿåœ¨ä½ çš„ã€ä¸œå—æ–¹å‘ã€‘</span>
            </div>

            <button class="btn btn-primary" style="width:100%" onclick="closeFeedback()">
                çŸ¥é“äº†ï¼Œç»§ç»­çŒœ
            </button>
        </div>
    </div>

<script>
    // --- æ¸¸æˆæ•°æ®é…ç½® ---
    // å¢åŠ äº† img å­—æ®µï¼Œä½¿ç”¨ pravatar.cc çš„éšæœºå¤´åƒ
    const providers = [
        { id: 1, name: "æå¸ˆå‚…", job: "ç»´ä¿®", gender:"ç”·", age:"80å", orders: 1200, score: 4.9, img: "https://i.pravatar.cc/150?img=11", isTarget: true,  pos: {x: 75, y: 72} }, 
        { id: 2, name: "ç‹é˜¿å§¨", job: "ä¿æ´", gender:"å¥³", age:"70å", orders: 890,  score: 5.0, img: "https://i.pravatar.cc/150?img=5", isTarget: false, pos: {x: 20, y: 20} },
        { id: 3, name: "å¼ æ•™ç»ƒ", job: "ç§æ•™", gender:"ç”·", age:"90å", orders: 320,  score: 4.8, img: "https://i.pravatar.cc/150?img=3", isTarget: false, pos: {x: 80, y: 20} },
        { id: 4, name: "èµµåŒ»ç”Ÿ", job: "å® åŒ»", gender:"å¥³", age:"90å", orders: 560,  score: 4.9, img: "https://i.pravatar.cc/150?img=9", isTarget: false, pos: {x: 20, y: 70} },
        // ä¿®æ­£åæ ‡ï¼Œé¿å¼€ 15%-20% top çš„æ ‡é¢˜åŒºåŸŸ
        { id: 5, name: "é™ˆå¸ˆå‚…", job: "å¼€é”", gender:"ç”·", age:"80å", orders: 2100, score: 5.0, img: "https://i.pravatar.cc/150?img=13", isTarget: false, pos: {x: 50, y: 28} }, // åŸ15æ”¹28
        { id: 6, name: "å´å¤§å§", job: "æœˆå«‚", gender:"å¥³", age:"70å", orders: 150,  score: 4.7, img: "https://i.pravatar.cc/150?img=20", isTarget: false, pos: {x: 10, y: 45} }, // åŸ15æ”¹10
        { id: 7, name: "éƒ‘å°å“¥", job: "è·‘è…¿", gender:"ç”·", age:"00å", orders: 3400, score: 4.9, img: "https://i.pravatar.cc/150?img=14", isTarget: false, pos: {x: 85, y: 50} },
        { id: 8, name: "å­™æŠ€å¸ˆ", job: "ç¾ç”²", gender:"å¥³", age:"90å", orders: 400,  score: 4.8, img: "https://i.pravatar.cc/150?img=24", isTarget: false, pos: {x: 50, y: 75} },
        { id: 9, name: "å‘¨è€å¸ˆ", job: "å®¶æ•™", gender:"å¥³", age:"00å", orders: 200,  score: 5.0, img: "https://i.pravatar.cc/150?img=32", isTarget: false, pos: {x: 35, y: 38} }, // åŸ35æ”¹38
        { id: 10, name: "åˆ˜å¸æœº", job: "æ¬å®¶", gender:"ç”·", age:"80å", orders: 900,  score: 4.8, img: "https://i.pravatar.cc/150?img=53", isTarget: false, pos: {x: 65, y: 60} }
    ];

    let gameState = {
        propCount: 2,
        currentSelect: null,
        eliminatedIds: [],
        hintLevel: 0
    };

    const targetProvider = providers.find(p => p.isTarget);
    const mapArea = document.getElementById('mapArea');

    // --- 1. åˆå§‹åŒ–åœ°å›¾ (æ•£ç‚¹ç”Ÿæˆ) ---
    function initMap() {
        providers.forEach(p => {
            const el = document.createElement('div');
            el.className = 'avatar-node';
            el.id = `avatar-${p.id}`;
            // è®¾ç½®ä½ç½®
            el.style.left = p.pos.x + '%';
            el.style.top = p.pos.y + '%';
            // çœŸå®å¤´åƒï¼šæ’å…¥å›¾ç‰‡
            el.innerHTML = `
                <img src="${p.img}" alt="${p.name}">
                <div class="avatar-label">${p.job}</div>
            `;
            
            // æµ®åŠ¨åŠ¨ç”» (éšæœºå»¶è¿Ÿ)
            el.style.animation = `float 3s ease-in-out infinite`;
            el.style.animationDelay = `${Math.random() * 2}s`;
            
            el.onclick = () => openProfile(p);
            mapArea.appendChild(el);
        });

        // æ·»åŠ ç®€å•çš„æµ®åŠ¨å…³é”®å¸§
        const styleSheet = document.createElement("style");
        styleSheet.innerText = `@keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }`;
        document.head.appendChild(styleSheet);
    }

    // --- 2. æ¡£æ¡ˆäº¤äº’ ---
    function openProfile(p) {
        if (gameState.eliminatedIds.includes(p.id)) return;
        
        gameState.currentSelect = p;
        
        // å¡«å……æ•°æ®
        document.getElementById('pAvatarImg').src = p.img;
        document.getElementById('pName').innerText = p.name;
        document.getElementById('pOrders').innerText = p.orders;
        document.getElementById('pScore').innerText = p.score;
        document.getElementById('pAge').innerText = p.age;
        
        document.getElementById('pTags').innerHTML = `
            <span>${p.gender}</span>
            <span>${p.job}</span>
            <span>å®åè®¤è¯</span>
        `;
        
        document.getElementById('profileModal').style.display = 'flex';
    }

    function closeProfile() {
        document.getElementById('profileModal').style.display = 'none';
    }

    // --- 3. æ ¸å¿ƒæ¸¸æˆé€»è¾‘ï¼šçŒœæµ‹åˆ¤å®š ---
    function confirmGuess() {
        closeProfile();
        const p = gameState.currentSelect;

        if (p.isTarget) {
            // çŒœå¯¹äº† (Win)
            showFeedback(
                "ğŸ‰ æ­å–œä¸­å¥–ï¼",
                `å¤ªç¥äº†ï¼çœŸæ­£çš„ç¦æ˜Ÿå°±æ˜¯<b>${p.name}</b>ï¼<br>TAå°±åœ¨ä½ ä¸œå—æ–¹å‘ 0.12km å¤„ï¼`,
                "ğŸ", 
                `è¯·å‰å¾€å¡åŒ…æŸ¥æ”¶å…å•åˆ¸`
            );
        } else {
            // çŒœé”™äº† (Fail -> Hint)
            eliminateAvatar(p.id);
            
            const hint = generateSmartHint();
            showFeedback(
                "ğŸ˜­ å“å‘€é€‰é”™äº†ï¼",
                `${p.name} ç¦»ä½ å¤ªè¿œäº†ï¼<br>å…å•æœºä¼šæ­£åœ¨æµå¤±ï¼Œå¿«çœ‹ä¸‹é¢çš„çº¿ç´¢ï¼`,
                "ğŸ§­",
                hint
            );
        }
    }

    // --- 4. é“å…·é€»è¾‘ï¼šä¸»åŠ¨å·çœ‹ ---
    function useProp() {
        if (gameState.propCount <= 0) {
            alert("å·çœ‹æ¬¡æ•°å·²ç”¨å®Œï¼");
            return;
        }
        
        gameState.propCount--;
        document.getElementById('propCount').innerText = gameState.propCount;
        
        const hint = generateSmartHint();
        showFeedback(
            "ğŸ‘€ å·çœ‹æˆåŠŸï¼",
            "ä½ æ¶ˆè€—äº†ä¸€å¼ å·çœ‹å¡ï¼Œè·å–äº†å…³äºç›®æ ‡çš„é‡è¦æƒ…æŠ¥ï¼",
            "ğŸ•µï¸â€â™€ï¸",
            hint
        );
    }

    // --- 5. æ™ºèƒ½çº¿ç´¢ç”Ÿæˆç³»ç»Ÿ ---
    function generateSmartHint() {
        let hintText = "";
        const t = targetProvider;
        
        switch(gameState.hintLevel % 4) {
            case 0:
                let dir = "";
                if (t.pos.y > 60) dir += "å—";
                else if (t.pos.y < 40) dir += "åŒ—";
                if (t.pos.x > 60) dir += "ä¸œ";
                else if (t.pos.x < 40) dir += "è¥¿";
                if (dir === "") dir = "æ­£ä¸­";
                hintText = `ç›®æ ‡ä½ç½®çº¿ç´¢ï¼šTAåœ¨ä½ çš„ <b>${dir}æ–¹å‘</b>`;
                break;
            case 1:
                hintText = `ç›®æ ‡èº«ä»½çº¿ç´¢ï¼šTAæ˜¯ä¸€ä½ <b>${t.age} ${t.gender}æ€§</b> æœåŠ¡è€…`;
                break;
            case 2:
                hintText = `ç›®æ ‡ç‰¹å¾çº¿ç´¢ï¼šTAçš„èŒä¸šæ˜¯ <b>${t.job}</b> (æ¥å•é‡ ${t.orders}+)`;
                break;
            case 3:
                hintText = `ç»ˆæçº¿ç´¢ï¼šç›®æ ‡åå­—é‡Œå¸¦æœ‰ <b>â€œ${t.name[0]}â€</b> å­—`;
                break;
        }
        
        gameState.hintLevel++;
        return hintText;
    }

    // --- 6. åé¦ˆå¼¹çª—æ§åˆ¶ ---
    function showFeedback(title, msg, icon, clue) {
        document.getElementById('fbTitle').innerText = title;
        document.getElementById('fbMsg').innerHTML = msg;
        document.getElementById('fbIcon').innerText = icon;
        document.getElementById('clueText').innerHTML = clue;
        
        document.getElementById('feedbackModal').style.display = 'flex';
    }

    function closeFeedback() {
        document.getElementById('feedbackModal').style.display = 'none';
    }

    // --- 7. è§†è§‰æ•ˆæœï¼šæ¶ˆé™¤ ---
    function eliminateAvatar(id) {
        gameState.eliminatedIds.push(id);
        const el = document.getElementById(`avatar-${id}`);
        if (el) {
            el.classList.add('dead');
            setTimeout(() => {
                el.style.display = 'none';
            }, 300);
        }
    }

    // --- å€’è®¡æ—¶ ---
    let time = 300; 
    setInterval(() => {
        time--;
        if(time < 0) time = 0;
        let m = Math.floor(time / 60);
        let s = time % 60;
        document.getElementById('timer').innerText = 
            `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }, 1000);

    // å¯åŠ¨
    initMap();

</script>
</body>
</html>
